generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Salon {
  id           Int            @id @default(autoincrement())
  name         String
  logoUrl      String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  appointments Appointment[]
  settings     SalonSettings?
  users        SalonUser[]
  services     Service[]
  staff        Staff[]
}

model SalonSettings {
  id            Int      @id @default(autoincrement())
  workStartHour Int      @default(9)
  workEndHour   Int      @default(18)
  slotInterval  Int      @default(30)
  timezone      String   @default("Europe/Istanbul")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  salonId       Int      @unique
  salon         Salon    @relation(fields: [salonId], references: [id])
}

model SalonUser {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  role         UserRole
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  salonId      Int
  salon        Salon    @relation(fields: [salonId], references: [id])
  staffProfile Staff?
}

model Staff {
  id           Int           @id @default(autoincrement())
  name         String
  phone        String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  salonId      Int
  userId       Int?          @unique
  appointments Appointment[]
  leaves       Leave[]
  salon        Salon         @relation(fields: [salonId], references: [id])
  user         SalonUser?    @relation(fields: [userId], references: [id])
  services     Service[]     @relation("StaffServices")
}

model Leave {
  id        Int      @id @default(autoincrement())
  startDate DateTime @db.Date
  endDate   DateTime @db.Date
  reason    String?
  createdAt DateTime @default(now())
  staffId   Int
  staff     Staff    @relation(fields: [staffId], references: [id])
}

model Service {
  id           Int           @id @default(autoincrement())
  name         String
  description  String?
  price        Float
  duration     Int
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  salonId      Int
  appointments Appointment[]
  salon        Salon         @relation(fields: [salonId], references: [id])
  staff        Staff[]       @relation("StaffServices")
}

model Appointment {
  id            Int               @id @default(autoincrement())
  customerName  String
  customerPhone String
  startTime     DateTime
  endTime       DateTime
  status        AppointmentStatus @default(BOOKED)
  source        AppointmentSource @default(CUSTOMER)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  salonId       Int
  staffId       Int
  serviceId     Int
  salon         Salon             @relation(fields: [salonId], references: [id])
  service       Service           @relation(fields: [serviceId], references: [id])
  staff         Staff             @relation(fields: [staffId], references: [id])

  @@index([staffId, startTime, endTime])
}

enum UserRole {
  OWNER
  STAFF
}

enum AppointmentStatus {
  BOOKED
  CANCELLED
  NO_SHOW
  COMPLETED
}

enum AppointmentSource {
  CUSTOMER
  ADMIN
  AUTOMATION
}
